{"version":3,"file":"1d714253-7f3e-4c2c-a534-a8d37f9e4628.mjs","sources":["../../../src/mastra/tools/walletConnectionTool.ts"],"sourcesContent":["import { createTool } from '@mastra/core/tools';\nimport { z } from 'zod';\nimport { walletCache } from './sharedCaches';\n\nexport const walletConnectionTool = createTool({\n  id: 'wallet-connection',\n  description: `Connect or view the user's Phantom wallet address. This tool ONLY stores the PUBLIC wallet address - no private keys are ever stored. \n  Use this when the user wants to:\n  - Link their Phantom wallet\n  - Check which wallet is connected\n  - Update their wallet address`,\n  inputSchema: z.object({\n    action: z.enum(['connect', 'view', 'disconnect']).describe('Action to perform'),\n    walletAddress: z\n      .string()\n      .optional()\n      .describe('Solana wallet address (required for connect action)'),\n    userId: z.string().describe('User ID from Telegram'),\n  }),\n  outputSchema: z.object({\n    success: z.boolean(),\n    message: z.string(),\n    walletAddress: z.string().optional(),\n    balance: z.number().optional().describe('SOL balance'),\n  }),\n  execute: async ({ context, mastra, runtimeContext }) => {\n    const logger = mastra?.getLogger();\n    const { action, walletAddress } = context;\n    const userId = context.userId || (runtimeContext as any)?.resourceId || 'default-user';\n    const WALLET_KEY = `user_wallet_${userId}`;\n\n    logger?.info('üîó [WalletConnection] Starting wallet operation', {\n      action,\n      userId,\n      hasAddress: !!walletAddress,\n    });\n\n    try {\n      // Get current wallet data from cache\n      let walletData: { address: string; connectedAt: string } | null = walletCache.get(userId) || null;\n\n      if (action === 'connect') {\n        if (!walletAddress) {\n          logger?.error('‚ùå [WalletConnection] No wallet address provided');\n          return {\n            success: false,\n            message: 'Please provide your Phantom wallet address',\n          };\n        }\n\n        // Validate Solana address format (base58, 32-44 chars)\n        if (!/^[1-9A-HJ-NP-Za-km-z]{32,44}$/.test(walletAddress)) {\n          logger?.error('‚ùå [WalletConnection] Invalid wallet address format');\n          return {\n            success: false,\n            message: 'Invalid Solana wallet address format',\n          };\n        }\n\n        // Store wallet address in cache (PUBLIC address only, NO private keys)\n        const newWalletData = {\n          address: walletAddress,\n          connectedAt: new Date().toISOString(),\n        };\n\n        walletCache.set(userId, newWalletData);\n\n        logger?.info('‚úÖ [WalletConnection] Wallet connected successfully', {\n          userId,\n          address: walletAddress.slice(0, 8) + '...' + walletAddress.slice(-4),\n        });\n\n        return {\n          success: true,\n          message: `‚úÖ Wallet connected!\\n\\nüìç Address: ${walletAddress}\\n\\n‚ö†Ô∏è Your private keys stay in Phantom - this bot only stores your public address for read-only operations.`,\n          walletAddress,\n        };\n      }\n\n      if (action === 'view') {\n        if (!walletData || !walletData.address) {\n          logger?.info('üì≠ [WalletConnection] No wallet connected');\n          return {\n            success: false,\n            message:\n              'No wallet connected. Use /connect to link your Phantom wallet.',\n          };\n        }\n\n        const address = walletData.address;\n        logger?.info('üëÅÔ∏è [WalletConnection] Viewing connected wallet', {\n          userId,\n          address: address.slice(0, 8) + '...' + address.slice(-4),\n        });\n\n        return {\n          success: true,\n          message: `üìç Connected Wallet:\\n${address}\\n\\nConnected: ${new Date(walletData.connectedAt).toLocaleString()}`,\n          walletAddress: address,\n        };\n      }\n\n      if (action === 'disconnect') {\n        // Clear wallet data from cache\n        walletCache.delete(userId);\n\n        logger?.info('üîå [WalletConnection] Wallet disconnected', { userId });\n\n        return {\n          success: true,\n          message:\n            '‚úÖ Wallet disconnected. Your data has been removed from the bot.',\n        };\n      }\n\n      return {\n        success: false,\n        message: 'Unknown action',\n      };\n    } catch (error) {\n      logger?.error('‚ùå [WalletConnection] Error:', error);\n      return {\n        success: false,\n        message: `Error: ${error instanceof Error ? error.message : 'Unknown error'}`,\n      };\n    }\n  },\n});\n"],"names":[],"mappings":"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"}