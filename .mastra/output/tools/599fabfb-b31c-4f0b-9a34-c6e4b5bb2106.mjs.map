{"version":3,"file":"599fabfb-b31c-4f0b-9a34-c6e4b5bb2106.mjs","sources":["../../../src/mastra/tools/balanceCheckerTool.ts"],"sourcesContent":["import { createTool } from \"@mastra/core/tools\";\nimport { z } from \"zod\";\nimport { Connection, PublicKey, LAMPORTS_PER_SOL } from \"@solana/web3.js\";\n\n/**\n * Balance Checker Tool - Checks SOL balance for user wallets\n * Uses free Solana public RPC nodes\n */\n\nexport const balanceCheckerTool = createTool({\n  id: \"balance-checker-tool\",\n  description: \"Checks the SOL balance of the user's bot wallet. Returns current balance in SOL.\",\n\n  inputSchema: z.object({}),\n\n  outputSchema: z.object({\n    balance: z.number(),\n    walletAddress: z.string(),\n    success: z.boolean(),\n    message: z.string(),\n  }),\n\n  execute: async ({ context, mastra }) => {\n    const logger = mastra?.getLogger();\n\n    try {\n      // Get userId from context (passed from workflow)\n      const userId = (context as any).userId || 'default-user';\n      \n      logger?.info('üîß [BalanceCheckerTool] Starting balance check', { userId });\n      \n      const WALLET_KEY = `user_wallet_${userId}`;\n\n      // Get user's wallet from database\n      const memory = mastra?.memory;\n      if (!memory) {\n        throw new Error('Memory storage not available');\n      }\n\n      const messages = await memory.getMessages({\n        resourceId: userId,\n        threadId: WALLET_KEY,\n      });\n\n      if (!messages || messages.length === 0) {\n        logger?.warn('[BalanceCheckerTool] No wallet found for user', { userId });\n        return {\n          balance: 0,\n          walletAddress: '',\n          success: false,\n          message: 'No wallet found. Use /wallet to create one first.',\n        };\n      }\n\n      const lastMessage = messages[messages.length - 1];\n      const walletData = JSON.parse(lastMessage.content as string);\n      const publicKey = walletData.address; // Fixed: use 'address' not 'publicKey'\n\n      if (!publicKey) {\n        logger?.warn('[BalanceCheckerTool] Wallet data missing address');\n        return {\n          balance: 0,\n          walletAddress: '',\n          success: false,\n          message: 'Wallet address not found. Please reconnect your wallet.',\n        };\n      }\n\n      logger?.info('üìù [BalanceCheckerTool] Checking balance', { \n        userId,\n        walletAddress: publicKey \n      });\n\n      // Connect to Solana (using free public RPC)\n      const connection = new Connection('https://api.mainnet-beta.solana.com', 'confirmed');\n      \n      // Get balance\n      const pubKey = new PublicKey(publicKey);\n      const balanceLamports = await connection.getBalance(pubKey);\n      const balanceSOL = balanceLamports / LAMPORTS_PER_SOL;\n\n      logger?.info('‚úÖ [BalanceCheckerTool] Balance retrieved', { \n        userId,\n        walletAddress: publicKey,\n        balance: balanceSOL \n      });\n\n      return {\n        balance: balanceSOL,\n        walletAddress: publicKey,\n        success: true,\n        message: `Balance: ${balanceSOL.toFixed(4)} SOL`,\n      };\n    } catch (error: any) {\n      logger?.error('‚ùå [BalanceCheckerTool] Error checking balance', { error: error.message });\n      \n      return {\n        balance: 0,\n        walletAddress: '',\n        success: false,\n        message: `Failed to check balance: ${error.message}`,\n      };\n    }\n  },\n});\n"],"names":[],"mappings":"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"}