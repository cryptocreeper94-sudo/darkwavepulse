{"version":3,"file":"3f2bb15b-5449-44a1-9828-8149cdaf6dba.mjs","sources":["../../../src/mastra/tools/sentimentTool.ts"],"sourcesContent":["import { createTool } from \"@mastra/core/tools\";\nimport { z } from \"zod\";\nimport axios from \"axios\";\nimport { checkSubscriptionLimit } from \"../middleware/subscriptionCheck.js\";\n\n/**\n * Sentiment Tool - Analyzes social sentiment and community activity\n * Uses CoinGecko's free community data: Twitter, Reddit, GitHub activity\n * Calculates sentiment scores from social engagement metrics\n */\n\n// In-memory cache with 5-minute TTL (sentiment changes faster than price)\nconst sentimentCache = new Map<string, { data: any; timestamp: number }>();\nconst CACHE_TTL = 5 * 60 * 1000; // 5 minutes\n\nexport const sentimentTool = createTool({\n  id: \"sentiment-tool\",\n  description: \"Analyzes social sentiment and community activity for crypto assets. Returns Twitter followers, Reddit subscribers, GitHub activity, developer engagement, and calculated sentiment score (0-100). Higher scores indicate stronger community bullishness.\",\n\n  inputSchema: z.object({\n    ticker: z.string().describe(\"Cryptocurrency ticker symbol (e.g., BTC, ETH, SOL)\"),\n  }),\n\n  outputSchema: z.object({\n    ticker: z.string(),\n    sentimentScore: z.number().describe(\"Overall sentiment score 0-100 (higher = more bullish)\"),\n    sentimentLevel: z.enum([\"üî¥ Bearish\", \"üü° Neutral\", \"üü¢ Bullish\", \"üöÄ Very Bullish\"]),\n    socialMetrics: z.object({\n      twitterFollowers: z.number().optional(),\n      redditSubscribers: z.number().optional(),\n      telegramUsers: z.number().optional(),\n      githubStars: z.number().optional(),\n    }),\n    communityActivity: z.object({\n      reddit48hComments: z.number().optional(),\n      reddit48hPosts: z.number().optional(),\n      githubCommits4w: z.number().optional(),\n      developerScore: z.number().optional(),\n    }),\n    marketSentiment: z.object({\n      marketCapRank: z.number().optional(),\n      volumeChangePercent: z.number().optional(),\n      priceChangePercent24h: z.number().optional(),\n    }),\n    analysis: z.string().describe(\"Human-readable sentiment analysis\"),\n  }),\n\n  execute: async ({ context, mastra, runtimeContext }) => {\n    const logger = mastra?.getLogger();\n    logger?.info('üîß [SentimentTool] Starting execution', { ticker: context.ticker });\n\n    // Extract userId from runtimeContext\n    const userId = (runtimeContext as any)?.resourceId || 'unknown';\n    \n    // Check subscription limit\n    const limitCheck = await checkSubscriptionLimit(userId, 'search');\n    logger?.info('üîê [SentimentTool] Subscription check result', { userId, allowed: limitCheck.allowed });\n    \n    if (!limitCheck.allowed) {\n      logger?.warn('‚ö†Ô∏è [SentimentTool] Usage limit exceeded', { userId, message: limitCheck.message });\n      throw new Error(limitCheck.message || 'Daily search limit reached. Upgrade to Premium for unlimited access!');\n    }\n\n    const ticker = context.ticker.toUpperCase();\n\n    // Check cache first\n    const cacheKey = `sentiment-${ticker}`;\n    const cached = sentimentCache.get(cacheKey);\n    if (cached && (Date.now() - cached.timestamp) < CACHE_TTL) {\n      logger?.info('üì¶ [SentimentTool] Returning cached data', { ticker, cacheAge: Date.now() - cached.timestamp });\n      return cached.data;\n    }\n\n    // CoinGecko ID mapping (same as marketDataTool)\n    const COINGECKO_MAP: Record<string, string> = {\n      'BTC': 'bitcoin', 'ETH': 'ethereum', 'USDT': 'tether', 'BNB': 'binancecoin',\n      'SOL': 'solana', 'USDC': 'usd-coin', 'XRP': 'ripple', 'ADA': 'cardano',\n      'DOGE': 'dogecoin', 'TRX': 'tron', 'LINK': 'chainlink', 'AVAX': 'avalanche-2',\n      'SHIB': 'shiba-inu', 'DOT': 'polkadot', 'MATIC': 'matic-network', 'UNI': 'uniswap',\n      'NEAR': 'near', 'PEPE': 'pepe', 'APT': 'aptos', 'ARB': 'arbitrum', 'OP': 'optimism',\n      'SUI': 'sui', 'ATOM': 'cosmos', 'FIL': 'filecoin', 'LTC': 'litecoin', 'BCH': 'bitcoin-cash',\n      'XLM': 'stellar', 'ALGO': 'algorand', 'ICP': 'internet-computer', 'WIF': 'dogwifcoin',\n    };\n\n    const coinId = COINGECKO_MAP[ticker] || ticker.toLowerCase();\n\n    try {\n      logger?.info('üìä [SentimentTool] Fetching CoinGecko data', { ticker, coinId });\n\n      // Fetch coin data with community metrics\n      const response = await axios.get(`https://api.coingecko.com/api/v3/coins/${coinId}`, {\n        params: {\n          localization: false,\n          tickers: false,\n          market_data: true,\n          community_data: true,\n          developer_data: true,\n        },\n        timeout: 10000,\n      });\n\n      const data = response.data;\n      \n      // Extract social metrics\n      const socialMetrics = {\n        twitterFollowers: data.community_data?.twitter_followers || 0,\n        redditSubscribers: data.community_data?.reddit_subscribers || 0,\n        telegramUsers: data.community_data?.telegram_channel_user_count || 0,\n        githubStars: data.developer_data?.stars || 0,\n      };\n\n      // Extract community activity\n      const communityActivity = {\n        reddit48hComments: data.community_data?.reddit_average_comments_48h || 0,\n        reddit48hPosts: data.community_data?.reddit_average_posts_48h || 0,\n        githubCommits4w: data.developer_data?.commit_count_4_weeks || 0,\n        developerScore: data.developer_score || 0,\n      };\n\n      // Extract market sentiment indicators\n      const marketSentiment = {\n        marketCapRank: data.market_cap_rank || 9999,\n        volumeChangePercent: data.market_data?.volume_change_24h || 0,\n        priceChangePercent24h: data.market_data?.price_change_percentage_24h || 0,\n      };\n\n      // Calculate composite sentiment score (0-100)\n      const sentimentScore = calculateSentimentScore(\n        socialMetrics,\n        communityActivity,\n        marketSentiment\n      );\n\n      // Determine sentiment level\n      const sentimentLevel = \n        sentimentScore >= 75 ? \"üöÄ Very Bullish\" :\n        sentimentScore >= 50 ? \"üü¢ Bullish\" :\n        sentimentScore >= 30 ? \"üü° Neutral\" :\n        \"üî¥ Bearish\";\n\n      // Generate analysis text\n      const analysis = generateAnalysis(\n        ticker,\n        sentimentScore,\n        sentimentLevel,\n        socialMetrics,\n        communityActivity,\n        marketSentiment\n      );\n\n      const result = {\n        ticker,\n        sentimentScore: Math.round(sentimentScore),\n        sentimentLevel,\n        socialMetrics,\n        communityActivity,\n        marketSentiment,\n        analysis,\n      };\n\n      // Cache the result\n      sentimentCache.set(cacheKey, { data: result, timestamp: Date.now() });\n      logger?.info('‚úÖ [SentimentTool] Sentiment analysis complete', { ticker, sentimentScore, sentimentLevel });\n\n      return result;\n\n    } catch (error: any) {\n      logger?.error('‚ùå [SentimentTool] Failed to fetch sentiment data', { \n        ticker, \n        error: error.message \n      });\n      \n      // Return neutral sentiment on error\n      return {\n        ticker,\n        sentimentScore: 50,\n        sentimentLevel: \"üü° Neutral\" as const,\n        socialMetrics: {},\n        communityActivity: {},\n        marketSentiment: {},\n        analysis: `Unable to fetch sentiment data for ${ticker}. The community metrics may not be available for this asset.`,\n      };\n    }\n  },\n});\n\n/**\n * Calculate composite sentiment score from multiple data points\n * Score ranges from 0-100 (higher = more bullish)\n */\nfunction calculateSentimentScore(\n  social: any,\n  activity: any,\n  market: any\n): number {\n  let score = 0;\n  let weights = 0;\n\n  // Social following strength (0-25 points)\n  if (social.twitterFollowers > 0 || social.redditSubscribers > 0) {\n    const socialScore = Math.min(25, \n      (social.twitterFollowers / 100000) * 10 + // Max 10 points for 1M+ followers\n      (social.redditSubscribers / 50000) * 10 +  // Max 10 points for 500K+ subscribers\n      (social.telegramUsers / 50000) * 5         // Max 5 points for 500K+ users\n    );\n    score += socialScore;\n    weights += 25;\n  }\n\n  // Community engagement (0-25 points)\n  if (activity.reddit48hComments > 0 || activity.reddit48hPosts > 0) {\n    const engagementScore = Math.min(25,\n      (activity.reddit48hComments / 100) * 15 +  // Max 15 points for 1000+ comments\n      (activity.reddit48hPosts / 50) * 10        // Max 10 points for 500+ posts\n    );\n    score += engagementScore;\n    weights += 25;\n  }\n\n  // Developer activity (0-20 points)\n  if (activity.githubCommits4w > 0 || activity.developerScore > 0) {\n    const devScore = Math.min(20,\n      (activity.githubCommits4w / 10) * 10 +     // Max 10 points for 100+ commits\n      (activity.developerScore / 10) * 10        // Max 10 points for 100+ dev score\n    );\n    score += devScore;\n    weights += 20;\n  }\n\n  // Market sentiment (0-30 points)\n  if (market.priceChangePercent24h !== undefined) {\n    const priceScore = Math.min(30, Math.max(0,\n      (market.priceChangePercent24h + 10) * 1.5  // -10% = 0 points, +10% = 30 points\n    ));\n    score += priceScore;\n    weights += 30;\n  }\n\n  // Normalize to 0-100 scale\n  return weights > 0 ? (score / weights) * 100 : 50;\n}\n\n/**\n * Generate human-readable sentiment analysis\n */\nfunction generateAnalysis(\n  ticker: string,\n  score: number,\n  level: string,\n  social: any,\n  activity: any,\n  market: any\n): string {\n  const parts: string[] = [];\n\n  // Overall sentiment\n  parts.push(`${ticker} sentiment: ${level} (${Math.round(score)}/100)`);\n\n  // Social presence\n  if (social.twitterFollowers || social.redditSubscribers) {\n    const socialDesc = [];\n    if (social.twitterFollowers) socialDesc.push(`${formatNumber(social.twitterFollowers)} Twitter followers`);\n    if (social.redditSubscribers) socialDesc.push(`${formatNumber(social.redditSubscribers)} Reddit subscribers`);\n    parts.push(`Social: ${socialDesc.join(', ')}`);\n  }\n\n  // Community engagement\n  if (activity.reddit48hComments || activity.reddit48hPosts) {\n    parts.push(`Reddit 48h: ${activity.reddit48hComments || 0} comments, ${activity.reddit48hPosts || 0} posts`);\n  }\n\n  // Developer activity\n  if (activity.githubCommits4w) {\n    parts.push(`Dev activity: ${activity.githubCommits4w} GitHub commits (4 weeks)`);\n  }\n\n  // Market performance\n  if (market.priceChangePercent24h !== undefined) {\n    const priceEmoji = market.priceChangePercent24h > 0 ? \"üìà\" : \"üìâ\";\n    parts.push(`${priceEmoji} 24h price: ${market.priceChangePercent24h.toFixed(2)}%`);\n  }\n\n  // Interpretation\n  if (score >= 75) {\n    parts.push(\"Community is highly engaged and bullish. Strong social momentum.\");\n  } else if (score >= 50) {\n    parts.push(\"Positive community sentiment with healthy engagement.\");\n  } else if (score >= 30) {\n    parts.push(\"Neutral sentiment. Community activity is moderate.\");\n  } else {\n    parts.push(\"Weak community engagement. Social metrics are below average.\");\n  }\n\n  return parts.join(' | ');\n}\n\n/**\n * Format numbers with K/M/B suffixes\n */\nfunction formatNumber(num: number): string {\n  if (num >= 1000000) return `${(num / 1000000).toFixed(1)}M`;\n  if (num >= 1000) return `${(num / 1000).toFixed(1)}K`;\n  return num.toString();\n}\n"],"names":[],"mappings":"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"}