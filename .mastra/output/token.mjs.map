{"version":3,"file":"token.mjs","sources":["../.build/token.mjs"],"sourcesContent":["import { g as getDefaultExportFromCjs } from './_commonjsHelpers.mjs';\nimport { t as tokenError } from './_virtual__virtual-ai.mjs';\nimport { a as tokenUtil } from './token-util.mjs';\n\nfunction _mergeNamespaces(n, m) {\n  m.forEach(function (e) {\n    e && typeof e !== 'string' && !Array.isArray(e) && Object.keys(e).forEach(function (k) {\n      if (k !== 'default' && !(k in n)) {\n        var d = Object.getOwnPropertyDescriptor(e, k);\n        Object.defineProperty(n, k, d.get ? d : {\n          enumerable: true,\n          get: function () { return e[k]; }\n        });\n      }\n    });\n  });\n  return Object.freeze(n);\n}\n\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toCommonJS = (mod) => __copyProps(__defProp({}, \"__esModule\", { value: true }), mod);\nvar token_exports = {};\n__export(token_exports, {\n  refreshToken: () => refreshToken\n});\nvar token = __toCommonJS(token_exports);\nvar import_token_error = tokenError;\nvar import_token_util = tokenUtil;\nasync function refreshToken() {\n  const { projectId, teamId } = (0, import_token_util.findProjectInfo)();\n  let maybeToken = (0, import_token_util.loadToken)(projectId);\n  if (!maybeToken || (0, import_token_util.isExpired)((0, import_token_util.getTokenPayload)(maybeToken.token))) {\n    const authToken = (0, import_token_util.getVercelCliToken)();\n    if (!authToken) {\n      throw new import_token_error.VercelOidcTokenError(\n        \"Failed to refresh OIDC token: login to vercel cli\"\n      );\n    }\n    if (!projectId) {\n      throw new import_token_error.VercelOidcTokenError(\n        \"Failed to refresh OIDC token: project id not found\"\n      );\n    }\n    maybeToken = await (0, import_token_util.getVercelOidcToken)(authToken, projectId, teamId);\n    if (!maybeToken) {\n      throw new import_token_error.VercelOidcTokenError(\"Failed to refresh OIDC token\");\n    }\n    (0, import_token_util.saveToken)(maybeToken, projectId);\n  }\n  process.env.VERCEL_OIDC_TOKEN = maybeToken.token;\n  return;\n}\n\nvar token$1 = /*@__PURE__*/getDefaultExportFromCjs(token);\n\nvar token$2 = /*#__PURE__*/_mergeNamespaces({\n  __proto__: null,\n  default: token$1\n}, [token]);\n\nexport { token$2 as t };\n"],"names":[],"mappings":"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"}