{"version":3,"file":"replitmail.mjs","sources":["../../src/utils/replitmail.ts"],"sourcesContent":["import { z } from \"zod\";\n\n// Zod schema matching the backend implementation\nexport const zSmtpMessage = z.object({\n  to: z\n    .union([z.string().email(), z.array(z.string().email())])\n    .describe(\"Recipient email address(es)\"),\n  cc: z\n    .union([z.string().email(), z.array(z.string().email())])\n    .optional()\n    .describe(\"CC recipient email address(es)\"),\n  subject: z.string().describe(\"Email subject\"),\n  text: z.string().optional().describe(\"Plain text body\"),\n  html: z.string().optional().describe(\"HTML body\"),\n  attachments: z\n    .array(\n      z.object({\n        filename: z.string().describe(\"File name\"),\n        content: z.string().describe(\"Base64 encoded content\"),\n        contentType: z.string().optional().describe(\"MIME type\"),\n        encoding: z\n          .enum([\"base64\", \"7bit\", \"quoted-printable\", \"binary\"])\n          .default(\"base64\"),\n      })\n    )\n    .optional()\n    .describe(\"Email attachments\"),\n});\n\nexport type SmtpMessage = z.infer<typeof zSmtpMessage>\n\nfunction getAuthToken(): string {\n  const xReplitToken = process.env.REPL_IDENTITY\n    ? \"repl \" + process.env.REPL_IDENTITY\n    : process.env.WEB_REPL_RENEWAL\n      ? \"depl \" + process.env.WEB_REPL_RENEWAL\n      : null;\n\n  if (!xReplitToken) {\n    throw new Error(\n      \"No authentication token found. Please set REPL_IDENTITY or ensure you're running in Replit environment.\"\n    );\n  }\n\n  return xReplitToken;\n}\n\nexport async function sendEmail(message: SmtpMessage): Promise<{\n  accepted: string[];\n  rejected: string[];\n  pending?: string[];\n  messageId: string;\n  response: string;\n}> {\n  const authToken = getAuthToken();\n\n  const response = await fetch(\n    \"https://connectors.replit.com/api/v2/mailer/send\",\n    {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"X_REPLIT_TOKEN\": authToken,\n      },\n      body: JSON.stringify({\n        to: message.to,\n        cc: message.cc,\n        subject: message.subject,\n        text: message.text,\n        html: message.html,\n        attachments: message.attachments,\n      }),\n    }\n  );\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.message || \"Failed to send email\");\n  }\n\n  return await response.json();\n}\n"],"names":[],"mappings":";;AAG4B,EAAE,MAAA,CAAO;AAAA,EACnC,EAAA,EAAI,EACD,KAAA,CAAM,CAAC,EAAE,MAAA,EAAO,CAAE,OAAM,EAAG,CAAA,CAAE,MAAM,CAAA,CAAE,MAAA,GAAS,KAAA,EAAO,CAAC,CAAC,CAAA,CACvD,SAAS,6BAA6B,CAAA;AAAA,EACzC,EAAA,EAAI,EACD,KAAA,CAAM,CAAC,EAAE,MAAA,EAAO,CAAE,KAAA,EAAM,EAAG,CAAA,CAAE,KAAA,CAAM,EAAE,MAAA,EAAO,CAAE,OAAO,CAAC,CAAC,CAAA,CACvD,QAAA,EAAS,CACT,QAAA,CAAS,gCAAgC,CAAA;AAAA,EAC5C,OAAA,EAAS,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,eAAe,CAAA;AAAA,EAC5C,MAAM,CAAA,CAAE,MAAA,GAAS,QAAA,EAAS,CAAE,SAAS,iBAAiB,CAAA;AAAA,EACtD,MAAM,CAAA,CAAE,MAAA,GAAS,QAAA,EAAS,CAAE,SAAS,WAAW,CAAA;AAAA,EAChD,aAAa,CAAA,CACV,KAAA;AAAA,IACC,EAAE,MAAA,CAAO;AAAA,MACP,QAAA,EAAU,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,WAAW,CAAA;AAAA,MACzC,OAAA,EAAS,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,wBAAwB,CAAA;AAAA,MACrD,aAAa,CAAA,CAAE,MAAA,GAAS,QAAA,EAAS,CAAE,SAAS,WAAW,CAAA;AAAA,MACvD,QAAA,EAAU,CAAA,CACP,IAAA,CAAK,CAAC,QAAA,EAAU,MAAA,EAAQ,kBAAA,EAAoB,QAAQ,CAAC,CAAA,CACrD,OAAA,CAAQ,QAAQ;AAAA,KACpB;AAAA,GACH,CACC,QAAA,EAAS,CACT,QAAA,CAAS,mBAAmB;AACjC,CAAC;AAID,SAAS,YAAA,GAAuB;AAC9B,EAAA,MAAM,YAAA,GAAe,OAAA,CAAQ,GAAA,CAAI,aAAA,GAC7B,UAAU,OAAA,CAAQ,GAAA,CAAI,aAAA,GACtB,OAAA,CAAQ,GAAA,CAAI,gBAAA,GACV,OAAA,GAAU,OAAA,CAAQ,IAAI,gBAAA,GACtB,IAAA;AAEN,EAAA,IAAI,CAAC,YAAA,EAAc;AACjB,IAAA,MAAM,IAAI,KAAA;AAAA,MACR;AAAA,KACF;AAAA,EACF;AAEA,EAAA,OAAO,YAAA;AACT;AAEA,eAAsB,UAAU,OAAA,EAM7B;AACD,EAAA,MAAM,YAAY,YAAA,EAAa;AAE/B,EAAA,MAAM,WAAW,MAAM,KAAA;AAAA,IACrB,kDAAA;AAAA,IACA;AAAA,MACE,MAAA,EAAQ,MAAA;AAAA,MACR,OAAA,EAAS;AAAA,QACP,cAAA,EAAgB,kBAAA;AAAA,QAChB,gBAAA,EAAkB;AAAA,OACpB;AAAA,MACA,IAAA,EAAM,KAAK,SAAA,CAAU;AAAA,QACnB,IAAI,OAAA,CAAQ,EAAA;AAAA,QACZ,IAAI,OAAA,CAAQ,EAAA;AAAA,QACZ,SAAS,OAAA,CAAQ,OAAA;AAAA,QACjB,MAAM,OAAA,CAAQ,IAAA;AAAA,QACd,MAAM,OAAA,CAAQ,IAAA;AAAA,QACd,aAAa,OAAA,CAAQ;AAAA,OACtB;AAAA;AACH,GACF;AAEA,EAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,IAAA,MAAM,KAAA,GAAQ,MAAM,QAAA,CAAS,IAAA,EAAK;AAClC,IAAA,MAAM,IAAI,KAAA,CAAM,KAAA,CAAM,OAAA,IAAW,sBAAsB,CAAA;AAAA,EACzD;AAEA,EAAA,OAAO,MAAM,SAAS,IAAA,EAAK;AAC7B;;;;"}