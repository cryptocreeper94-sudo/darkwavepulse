{"version":3,"file":"registry-generator-NVVOHGRE.mjs","sources":["../.build/registry-generator-NVVOHGRE.mjs"],"sourcesContent":["import fs2 from 'fs/promises';\nimport nodePath__default from 'path';\n\nasync function atomicWriteFile(filePath, content, encoding = \"utf-8\") {\n  const randomSuffix = Math.random().toString(36).substring(2, 15);\n  const tempPath = `${filePath}.${process.pid}.${Date.now()}.${randomSuffix}.tmp`;\n  try {\n    await fs2.writeFile(tempPath, content, encoding);\n    await fs2.rename(tempPath, filePath);\n  } catch (error) {\n    try {\n      await fs2.unlink(tempPath);\n    } catch {\n    }\n    throw error;\n  }\n}\nasync function fetchProvidersFromGateways(gateways) {\n  const allProviders = {};\n  const allModels = {};\n  const maxRetries = 3;\n  for (const gateway of gateways) {\n    let lastError = null;\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\n      try {\n        const providers = await gateway.fetchProviders();\n        const isProviderRegistry = gateway.id === \"models.dev\";\n        for (const [providerId, config] of Object.entries(providers)) {\n          const typeProviderId = isProviderRegistry ? providerId : providerId === gateway.id ? gateway.id : `${gateway.id}/${providerId}`;\n          allProviders[typeProviderId] = config;\n          allModels[typeProviderId] = config.models.sort();\n        }\n        lastError = null;\n        break;\n      } catch (error) {\n        lastError = error instanceof Error ? error : new Error(String(error));\n        if (attempt < maxRetries) {\n          const delayMs = Math.min(1e3 * Math.pow(2, attempt - 1), 5e3);\n          await new Promise((resolve) => setTimeout(resolve, delayMs));\n        }\n      }\n    }\n    if (lastError) {\n      throw lastError;\n    }\n  }\n  return { providers: allProviders, models: allModels };\n}\nfunction generateTypesContent(models) {\n  const providerModelsEntries = Object.entries(models).map(([provider, modelList]) => {\n    const modelsList = modelList.map((m) => `'${m}'`);\n    const needsQuotes = !/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(provider);\n    const providerKey = needsQuotes ? `'${provider}'` : provider;\n    const singleLine = `  readonly ${providerKey}: readonly [${modelsList.join(\", \")}];`;\n    if (singleLine.length > 120) {\n      const formattedModels = modelList.map((m) => `    '${m}',`).join(\"\\n\");\n      return `  readonly ${providerKey}: readonly [\n${formattedModels}\n  ];`;\n    }\n    return singleLine;\n  }).join(\"\\n\");\n  return `/**\n * THIS FILE IS AUTO-GENERATED - DO NOT EDIT\n * Generated from model gateway providers\n */\n\n/**\n * Provider models mapping type\n * This is derived from the JSON data and provides type-safe access\n */\nexport type ProviderModelsMap = {\n${providerModelsEntries}\n};\n\n/**\n * Union type of all registered provider IDs\n */\nexport type Provider = keyof ProviderModelsMap;\n\n/**\n * Provider models mapping interface\n */\nexport interface ProviderModels {\n  [key: string]: string[];\n}\n\n/**\n * OpenAI-compatible model ID type\n * Dynamically derived from ProviderModelsMap\n * Full provider/model paths (e.g., \"openai/gpt-4o\", \"anthropic/claude-3-5-sonnet-20241022\")\n */\nexport type ModelRouterModelId =\n  | {\n      [P in Provider]: \\`\\${P}/\\${ProviderModelsMap[P][number]}\\`;\n    }[Provider]\n  | (string & {});\n\n/**\n * Extract the model part from a ModelRouterModelId for a specific provider\n * Dynamically derived from ProviderModelsMap\n * Example: ModelForProvider<'openai'> = 'gpt-4o' | 'gpt-4-turbo' | ...\n */\nexport type ModelForProvider<P extends Provider> = ProviderModelsMap[P][number];\n`;\n}\nasync function writeRegistryFiles(jsonPath, typesPath, providers, models) {\n  const jsonDir = nodePath__default.dirname(jsonPath);\n  const typesDir = nodePath__default.dirname(typesPath);\n  await fs2.mkdir(jsonDir, { recursive: true });\n  await fs2.mkdir(typesDir, { recursive: true });\n  const registryData = {\n    providers,\n    models,\n    version: \"1.0.0\"\n  };\n  await atomicWriteFile(jsonPath, JSON.stringify(registryData, null, 2), \"utf-8\");\n  const typeContent = generateTypesContent(models);\n  await atomicWriteFile(typesPath, typeContent, \"utf-8\");\n}\n\nexport { atomicWriteFile, fetchProvidersFromGateways, generateTypesContent, writeRegistryFiles };\n//# sourceMappingURL=registry-generator-NVVOHGRE.mjs.map\n"],"names":["nodePath__default"],"mappings":";;;AAGA,eAAe,eAAe,CAAC,QAAQ,EAAE,OAAO,EAAE,QAAQ,GAAG,OAAO,EAAE;AACtE,EAAE,MAAM,YAAY,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC;AAClE,EAAE,MAAM,QAAQ,GAAG,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,EAAE,YAAY,CAAC,IAAI,CAAC;AACjF,EAAE,IAAI;AACN,IAAI,MAAM,GAAG,CAAC,SAAS,CAAC,QAAQ,EAAE,OAAO,EAAE,QAAQ,CAAC;AACpD,IAAI,MAAM,GAAG,CAAC,MAAM,CAAC,QAAQ,EAAE,QAAQ,CAAC;AACxC,EAAE,CAAC,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,IAAI;AACR,MAAM,MAAM,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC;AAChC,IAAI,CAAC,CAAC,MAAM;AACZ,IAAI;AACJ,IAAI,MAAM,KAAK;AACf,EAAE;AACF;AACA,eAAe,0BAA0B,CAAC,QAAQ,EAAE;AACpD,EAAE,MAAM,YAAY,GAAG,EAAE;AACzB,EAAE,MAAM,SAAS,GAAG,EAAE;AACtB,EAAE,MAAM,UAAU,GAAG,CAAC;AACtB,EAAE,KAAK,MAAM,OAAO,IAAI,QAAQ,EAAE;AAClC,IAAI,IAAI,SAAS,GAAG,IAAI;AACxB,IAAI,KAAK,IAAI,OAAO,GAAG,CAAC,EAAE,OAAO,IAAI,UAAU,EAAE,OAAO,EAAE,EAAE;AAC5D,MAAM,IAAI;AACV,QAAQ,MAAM,SAAS,GAAG,MAAM,OAAO,CAAC,cAAc,EAAE;AACxD,QAAQ,MAAM,kBAAkB,GAAG,OAAO,CAAC,EAAE,KAAK,YAAY;AAC9D,QAAQ,KAAK,MAAM,CAAC,UAAU,EAAE,MAAM,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;AACtE,UAAU,MAAM,cAAc,GAAG,kBAAkB,GAAG,UAAU,GAAG,UAAU,KAAK,OAAO,CAAC,EAAE,GAAG,OAAO,CAAC,EAAE,GAAG,CAAC,EAAE,OAAO,CAAC,EAAE,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC;AACzI,UAAU,YAAY,CAAC,cAAc,CAAC,GAAG,MAAM;AAC/C,UAAU,SAAS,CAAC,cAAc,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE;AAC1D,QAAQ;AACR,QAAQ,SAAS,GAAG,IAAI;AACxB,QAAQ;AACR,MAAM,CAAC,CAAC,OAAO,KAAK,EAAE;AACtB,QAAQ,SAAS,GAAG,KAAK,YAAY,KAAK,GAAG,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AAC7E,QAAQ,IAAI,OAAO,GAAG,UAAU,EAAE;AAClC,UAAU,MAAM,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,OAAO,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC;AACvE,UAAU,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,KAAK,UAAU,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;AACtE,QAAQ;AACR,MAAM;AACN,IAAI;AACJ,IAAI,IAAI,SAAS,EAAE;AACnB,MAAM,MAAM,SAAS;AACrB,IAAI;AACJ,EAAE;AACF,EAAE,OAAO,EAAE,SAAS,EAAE,YAAY,EAAE,MAAM,EAAE,SAAS,EAAE;AACvD;AACA,SAAS,oBAAoB,CAAC,MAAM,EAAE;AACtC,EAAE,MAAM,qBAAqB,GAAG,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,QAAQ,EAAE,SAAS,CAAC,KAAK;AACtF,IAAI,MAAM,UAAU,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AACrD,IAAI,MAAM,WAAW,GAAG,CAAC,4BAA4B,CAAC,IAAI,CAAC,QAAQ,CAAC;AACpE,IAAI,MAAM,WAAW,GAAG,WAAW,GAAG,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAC,GAAG,QAAQ;AAChE,IAAI,MAAM,UAAU,GAAG,CAAC,WAAW,EAAE,WAAW,CAAC,YAAY,EAAE,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC;AACxF,IAAI,IAAI,UAAU,CAAC,MAAM,GAAG,GAAG,EAAE;AACjC,MAAM,MAAM,eAAe,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC;AAC5E,MAAM,OAAO,CAAC,WAAW,EAAE,WAAW,CAAC;AACvC,EAAE,eAAe;AACjB,IAAI,CAAC;AACL,IAAI;AACJ,IAAI,OAAO,UAAU;AACrB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC;AACf,EAAE,OAAO,CAAC;AACV;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE,qBAAqB;AACvB;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA,eAAe,kBAAkB,CAAC,QAAQ,EAAE,SAAS,EAAE,SAAS,EAAE,MAAM,EAAE;AAC1E,EAAE,MAAM,OAAO,GAAGA,0BAAiB,CAAC,OAAO,CAAC,QAAQ,CAAC;AACrD,EAAE,MAAM,QAAQ,GAAGA,0BAAiB,CAAC,OAAO,CAAC,SAAS,CAAC;AACvD,EAAE,MAAM,GAAG,CAAC,KAAK,CAAC,OAAO,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC;AAC/C,EAAE,MAAM,GAAG,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC;AAChD,EAAE,MAAM,YAAY,GAAG;AACvB,IAAI,SAAS;AACb,IAAI,MAAM;AACV,IAAI,OAAO,EAAE;AACb,GAAG;AACH,EAAE,MAAM,eAAe,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE,IAAI,EAAE,CAAC,CAAC,EAAE,OAAO,CAAC;AACjF,EAAE,MAAM,WAAW,GAAG,oBAAoB,CAAC,MAAM,CAAC;AAClD,EAAE,MAAM,eAAe,CAAC,SAAS,EAAE,WAAW,EAAE,OAAO,CAAC;AACxD;;;;"}